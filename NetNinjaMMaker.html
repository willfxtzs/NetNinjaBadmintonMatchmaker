<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Net Ninjas Badminton Matchmaker</title>
  <style>
    body { font-family: sans-serif; padding: 16px; }

    .section { margin-bottom: 20px; }

    .court {
      border: 2px solid #000;
      padding: 10px;
      margin-bottom: 10px;
      min-height: 80px;
    }

    .player {
      display: inline-block;
      border: 1px solid #333;
      padding: 4px 8px;
      margin: 4px;
      background: #eee;
    }

    .draggable {
      cursor: grab;
    }

    .dropzone {
      min-height: 30px;
      padding: 6px;
      border: 1px dashed #999;
      margin-top: 6px;
    }

    button { margin: 2px; }
  </style>
</head>
<body>

<h1>Net Ninjas Badminton Matchmaker</h1>

<div class="section">
  <input id="playerInput" placeholder="Player name">
  <button onclick="addPlayer()">Add Player</button>
</div>

<div class="section">
  <h3>Queue</h3>
  <button onclick="clearQueue()">Clear Queue</button>
  <div id="queue" class="dropzone"
       ondragover="allowDrop(event)"
       ondrop="dropToQueue(event)">
  </div>
</div>

<div class="section">
  <button onclick="addCourt()">Add Court</button>
  <button onclick="removeCourt()">Remove Court</button>
  <button onclick="clearAllCourts()">Clear All Courts Players</button>
</div>

<div class="section">
  <h3>Courts</h3>
  <div id="courts"></div>
</div>

<script>
/* ========= STATE ========= */

let queue = [];
let courts = [
  { mode: "2v2", players: [] },
  { mode: "2v2", players: [] }
];

let draggedPlayer = null;
let draggedFromCourt = null;

/* ========= INPUT ========= */

document.getElementById("playerInput")
  .addEventListener("keydown", e => {
    if (e.key === "Enter") addPlayer();
  });

/* ========= ACTIONS ========= */

function addPlayer() {
  const input = document.getElementById("playerInput");
  const name = input.value.trim();
  if (!name) return;
  queue.push(name);
  input.value = "";
  render();
}

function removeQueuePlayer(index) {
  queue.splice(index, 1);
  render();
}

function addCourt() {
  courts.push({ mode: "2v2", players: [] });
  render();
}

function removeCourt() {
  const court = courts.pop();
  if (court) queue.push(...court.players);
  render();
}

function setMode(index, mode) {
  const court = courts[index];
  queue.push(...court.players);
  court.players = [];
  court.mode = mode;
  render();
}

function randomAssign(index) {
  const court = courts[index];
  const needed = court.mode === "1v1" ? 2 : 4;

  queue.push(...court.players);
  court.players = [];

  shuffle(queue);
  court.players = queue.splice(0, needed);
  render();
}

function removePlayerFromCourt(courtIndex, playerIndex) {
  const player = courts[courtIndex].players.splice(playerIndex, 1)[0];
  queue.push(player);
  render();
}

function clearCourt(index) {
  queue.push(...courts[index].players);
  courts[index].players = [];
  render();
}

function clearAllCourts() {
  courts.forEach(court => {
    queue.push(...court.players);
    court.players = [];
  });
  render();
}

function clearQueue() {
  queue = [];
  render();
}

/* ========= DRAG & DROP ========= */

function dragStart(player, courtIndex = null) {
  draggedPlayer = player;
  draggedFromCourt = courtIndex;
}

function allowDrop(e) {
  e.preventDefault();
}

function dropToQueue(e) {
  e.preventDefault();

  if (draggedFromCourt !== null) {
    courts[draggedFromCourt].players =
      courts[draggedFromCourt].players.filter(p => p !== draggedPlayer);
  }

  queue.push(draggedPlayer);
  draggedPlayer = draggedFromCourt = null;
  render();
}

function dropToCourt(e, index) {
  e.preventDefault();
  const court = courts[index];
  const max = court.mode === "1v1" ? 2 : 4;

  if (court.players.length >= max) return;

  if (draggedFromCourt !== null) {
    courts[draggedFromCourt].players =
      courts[draggedFromCourt].players.filter(p => p !== draggedPlayer);
  } else {
    queue = queue.filter(p => p !== draggedPlayer);
  }

  court.players.push(draggedPlayer);
  draggedPlayer = draggedFromCourt = null;
  render();
}

/* ========= UTIL ========= */

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

/* ========= RENDER ========= */

function render() {
  const queueDiv = document.getElementById("queue");
  queueDiv.innerHTML = "";

  queue.forEach((p, i) => {
    const span = document.createElement("span");
    span.className = "player draggable";
    span.draggable = true;
    span.ondragstart = () => dragStart(p);
    span.innerHTML = `
      ${p},
      <button onclick="removeQueuePlayer(${i})">X</button>
    `;
    queueDiv.appendChild(span);
  });

  const courtsDiv = document.getElementById("courts");
  courtsDiv.innerHTML = "";

  courts.forEach((court, i) => {
    const div = document.createElement("div");
    div.className = "court";
    div.ondragover = allowDrop;
    div.ondrop = e => dropToCourt(e, i);

    div.innerHTML = `
      <strong>Court ${i + 1}</strong><br>
      Mode:
      <select onchange="setMode(${i}, this.value)">
        <option value="1v1" ${court.mode === "1v1" ? "selected" : ""}>1v1</option>
        <option value="2v2" ${court.mode === "2v2" ? "selected" : ""}>2v2</option>
      </select>
      <button onclick="randomAssign(${i})">Random</button>
      <button onclick="clearCourt(${i})">Clear Court</button>
      <div class="dropzone">
        ${court.players.map((p, j) =>
          `<div class="player draggable" draggable="true"
             ondragstart="dragStart('${p}', ${i})">
             ${p}
             <button onclick="removePlayerFromCourt(${i}, ${j})">X</button>
           </div>`
        ).join("")}
      </div>
    `;

    courtsDiv.appendChild(div);
  });
}

render();
</script>

</body>
</html>
